<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.enn.energy.price.dal.mapper.ext.proxyprice.ElectricityTimeSectionCustomMapper">
    <sql id="Base_Column_List">
        id, season_section_id, time_section_id, start_time, end_time, periods, state, compare,
        temperature, create_time, update_time
    </sql>
    <insert id="batchInsertTimeSection">
        <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into electricity_time_section (season_section_id, time_section_id, start_time,
        end_time, periods, state,
        compare, temperature, create_time,
        update_time)
        values
        <foreach collection="times" item="time" separator=",">
            (#{time.seasonSectionId,jdbcType=VARCHAR}, #{time.timeSectionId,jdbcType=VARCHAR}, #{time.startTime,jdbcType=VARCHAR},
            #{time.endTime,jdbcType=VARCHAR}, #{time.periods,jdbcType=VARCHAR}, #{time.state,jdbcType=TINYINT},
            #{time.compare,jdbcType=VARCHAR}, #{time.temperature,jdbcType=VARCHAR}, #{time.createTime,jdbcType=TIMESTAMP},
            #{time.updateTime,jdbcType=TIMESTAMP})
        </foreach>
    </insert>


    <update id="batchDeleteTimeSectionByIds">
        update electricity_time_section
        set state=#{state},update_time=#{updateTime}
        WHERE id IN
        <foreach collection="ids" item="id" open="(" close=")" separator=",">
            #{id}
        </foreach>
    </update>


    <update id="batchUpdateTimeSection">
        update electricity_time_section
        <trim prefix="set" suffixOverrides=",">
            <trim prefix="periods=case" suffix="end,">
                <foreach collection="list" item="i" index="index">
                    <if test="i.periods != null and i.periods != ''">
                        when id=#{i.id} then #{i.periods}
                    </if>
                </foreach>
            </trim>
            <trim prefix="start_time=case" suffix="end,">
                <foreach collection="list" item="i" index="index">
                    <if test="i.seaEndDate != null">
                        when id=#{i.id} then #{i.seaEndDate}
                    </if>
                </foreach>
            </trim>
            <trim prefix="end_time=case" suffix="end,">
                <foreach collection="list" item="i" index="index">
                    <if test="i.updateTime != null">
                        when id=#{i.id} then #{i.updateTime}
                    </if>
                </foreach>
            </trim>
            <trim prefix="compare=case" suffix="end,">
                <foreach collection="list" item="i" index="index">
                    <if test="i.updateTime != null">
                        when id=#{i.id} then #{i.updateTime}
                    </if>
                </foreach>
            </trim>
            <trim prefix="temperature=case" suffix="end,">
                <foreach collection="list" item="i" index="index">
                    <if test="i.updateTime != null">
                        when id=#{i.id} then #{i.updateTime}
                    </if>
                </foreach>
            </trim>
            <trim prefix="update_time=case" suffix="end,">
                <foreach collection="list" item="i" index="index">
                    <if test="i.updateTime != null">
                        when id=#{i.id} then #{i.updateTime}
                    </if>
                </foreach>
            </trim>
        </trim>
        where id in
        <foreach collection="list" separator="," open="(" close=")" item="i" index="index" >
            #{i.id}
        </foreach>
        and state=0


    </update>

    <delete id="batchDeleteTimeSectionBySeasonSectionIds">
        update electricity_time_section
        set state=#{state},update_time=#{updateTime}
        WHERE season_section_id IN
        <foreach collection="seasonSectionIds" item="seasonSectionId" open="(" close=")" separator=",">
            #{seasonSectionId}
        </foreach>
    </delete>
    <select id="getTimeSectionListBySeasonSectionId"
            resultType="com.enn.energy.price.dal.po.mbg.ElectricityTimeSection">
        select
        <include refid="Base_Column_List" />
        from electricity_time_section
        where season_section_id=#{seasonSectionId} and state=0
    </select>
</mapper>